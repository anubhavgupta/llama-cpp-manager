<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLaMA CPP Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#2196f3">
    <meta name="description" content="A browser-based tool to configure and run llama-cpp server">
</head>
<body>
    <div class="container">
        <h1 class="app-title">LLaMA CPP Manager</h1>
        
        <div class="main-layout">
            <!-- Configuration Panel (Left) -->
            <div class="config-panel">
                <div class="config-header">
                    <h2>Configurations</h2>
                    <button id="addConfigBtn" class="btn btn-primary">+ Add</button>
                </div>
                <dialog id="configFormContainer" class="config-form-container">
                    <h3 id="configFormTitle">Create New Configuration</h3>
                    <div class="form-group">
                        <label for="configName">Configuration Name:</label>
                        <input type="text" id="configName" class="form-control" placeholder="Enter configuration name">
                    </div>
                    <div class="form-actions">
                        <button id="saveConfigBtn" class="btn btn-primary">Save</button>
                        <button id="cancelConfigBtn" class="btn btn-secondary">Cancel</button>
                    </div>
                </dialog>
                <div id="configList" class="config-list"></div>
                
                <!-- System Metrics Graphs (Bottom of Left Panel) -->
                <div class="system-metrics-container">
                    <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 14px; color: #666;">System Resources</h3>
                    <div class="metrics-graphs">
                        <div class="metric-graph">
                            <div class="graph-title">CPU Usage</div>
                            <canvas id="cpuGraph" class="graph-canvas"></canvas>
                            <div class="metric-value" id="cpuValue">0%</div>
                        </div>
                        <div class="metric-graph">
                            <div class="graph-title">RAM Usage</div>
                            <canvas id="ramGraph" class="graph-canvas"></canvas>
                            <div class="metric-value" id="ramValue">0%</div>
                        </div>
                        <div class="metric-graph">
                            <div class="graph-title">GPU Usage</div>
                            <canvas id="gpuGraph" class="graph-canvas"></canvas>
                            <div class="metric-value" id="gpuValue">0%</div>
                        </div>
                        <div class="metric-graph">
                            <div class="graph-title">VRAM Usage</div>
                            <canvas id="vramGraph" class="graph-canvas"></canvas>
                            <div class="metric-value" id="vramValue">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content (Right) -->
            <div class="main-content">
                <div class="input-section">
                    <h3>Server Configuration</h3>
                    <div class="form-group">
                        <label for="serverPath">LLaMA Server Path:</label>
                        <input type="text" id="serverPath" class="form-control" placeholder="Enter path to llama-server.exe">
                    </div>

                    <h3>Model Configuration</h3>
                    <div class="form-group">
                        <label for="modelPath">Model Path (-m):</label>
                        <select id="modelPath" class="form-control">
                            <option value="">-- Select a Model --</option>
                        </select>
                    </div>

                    <h3>GPU Configuration</h3>
                    <div class="form-group">
                        <label for="ngl">GPU Layers (-ngl):</label>
                        <input type="number" id="ngl" class="form-control" min="0" value="99">
                    </div>

                    <h3>Performance Settings</h3>
                    <div class="form-group">
                        <label for="threads">Threads (-t):</label>
                        <input type="number" id="threads" class="form-control" min="1" value="12">
                    </div>

                    <h3>Sampling Parameters</h3>
                    <div class="form-group">
                        <label for="temp">Temperature (--temp):</label>
                        <input type="number" id="temp" class="form-control" step="0.01" min="0" value="0.7">
                    </div>
                    <div class="form-group">
                        <label for="topK">Top-K (--top-k):</label>
                        <input type="number" id="topK" class="form-control" min="0" value="20">
                    </div>
                    <div class="form-group">
                        <label for="topP">Top-P (--top-p):</label>
                        <input type="number" id="topP" class="form-control" step="0.01" min="0" max="1" value="0.00">
                    </div>
                    <div class="form-group">
                        <label for="repeatPenalty">Repeat Penalty (--repeat-penalty):</label>
                        <input type="number" id="repeatPenalty" class="form-control" step="0.01" min="0" value="1.05">
                    </div>

                    <h3>Memory Settings</h3>
                    <div class="inline-checkboxes">
                        <div class="form-group">
                            <label for="mlock">Memory Lock (--mlock):</label>
                            <input type="checkbox" id="mlock" class="form-control checkbox">
                        </div>
                        <div class="form-group">
                            <label for="swaFull">SWA Full (--swa-full):</label>
                            <input type="checkbox" id="swaFull" class="form-control checkbox">
                        </div>
                    </div>

                    <h3>Advanced Settings</h3>
                    <div class="form-group">
                        <label for="contextSize">Context Size (-c):</label>
                        <input type="number" id="contextSize" class="form-control" min="1" value="16384">
                    </div>
                    <div class="form-group">
                        <label for="nCpuMoe">CPU MoE Layers (--n-cpu-moe):</label>
                        <input type="number" id="nCpuMoe" class="form-control" min="0" value="8">
                    </div>
                    <div class="inline-checkboxes">
                        <div class="form-group">
                            <label for="cpuMoe">CPU MoE (--cpu-moe):</label>
                            <input type="checkbox" id="cpuMoe" class="form-control checkbox">
                        </div>
                    </div>

                    <!-- New Context Token Parameters -->
                    <h3>Context Token Parameters</h3>
                    <div class="inline-checkboxes">
                        <div class="form-group">
                            <label for="ctkEnable">Enable -ctk/-ctv:</label>
                            <input type="checkbox" id="ctkEnable" class="form-control checkbox">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="contextTokenKey">Context Token Key (-ctk):</label>
                        <select id="contextTokenKey" class="form-control" disabled>
                            <option value="f32">f32</option>
                            <option value="f16" selected>f16</option>
                            <option value="bf16">bf16</option>
                            <option value="q8_0">q8_0</option>
                            <option value="q4_0">q4_0</option>
                            <option value="q4_1">q4_1</option>
                            <option value="iq4_nl">iq4_nl</option>
                            <option value="q5_0">q5_0</option>
                            <option value="q5_1">q5_1</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contextTokenValue">Context Token Value (-ctv):</label>
                        <select id="contextTokenValue" class="form-control" disabled>
                            <option value="f32">f32</option>
                            <option value="f16" selected>f16</option>
                            <option value="bf16">bf16</option>
                            <option value="q8_0">q8_0</option>
                            <option value="q4_0">q4_0</option>
                            <option value="q4_1">q4_1</option>
                            <option value="iq4_nl">iq4_nl</option>
                            <option value="q5_0">q5_0</option>
                            <option value="q5_1">q5_1</option>
                        </select>
                    </div>
                    <div class="inline-checkboxes">
                        <div class="form-group">
                            <label for="fastAttention">Fast Attention (--fa):</label>
                            <input type="checkbox" id="fastAttention" class="form-control checkbox">
                        </div>
                        <div class="form-group">
                            <label for="jinja">Jinja (--jinja):</label>
                            <input type="checkbox" id="jinja" class="form-control checkbox">
                        </div>
                    </div>

                    <!-- Action Buttons with Model Status -->
                    <div class="action-buttons-container">
                        <div class="action-buttons">
                            <button id="launchBtn" class="btn btn-primary">Launch</button>
                            <button id="stopBtn" class="btn btn-danger" disabled>Stop</button>
                        </div>
                        
                        <!-- Model Status Inline -->
                        <div class="model-status-inline">
                            <div id="modelStatusMessage" class="status-message">Not running</div>
                        </div>
                    </div>
                </div>
                
                <!-- Model Output Section -->
                <div class="model-status-output-section">
                    <div class="model-status-container">
                        <h3>Model Status</h3>
                        <div id="modelProcessInfo" class="process-info">No process information</div>
                    </div>
                    
                    <div class="model-output-container">
                        <h3>Model Output</h3>
                        <div id="modelOutput" class="output-content">No output yet...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js" type="module"></script>
</body>
</html>
